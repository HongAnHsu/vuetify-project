import{O as w,Q as V,P as B,x as q,o as b,T as h,W as u,Y as N,Z as r,c as s,as as P,a8 as e,X as _,a4 as S,$,_ as T,a2 as c,K as d,a1 as y,at as z,V as I}from"./index-46bf2304.js";import{V as R}from"./VContainer-f80d1fb1.js";import{V as m,a as A}from"./VRow-88e86a4d.js";const D=e("h1",{style:{color:"white","text-shadow":"1px 1px 2px red, 0 0 1em blue, 0 0 0.2em blue"}},"購物車",-1),E=e("thead",{style:{background:"orange","font-size":"24px","text-shadow":"0.1em 0.1em 0.2em rgb(100, 100, 100)"}},[e("tr",null,[e("th",null,"圖片"),e("th",null,"名稱"),e("th",null,"價格"),e("th",null,"數量"),e("th",null,"總金額"),e("th",null,"移除")])],-1),F={key:0},K=e("td",{colspan:"6",class:"text-center"},"快來選購美食吧!",-1),L=[K],O={style:{color:"white"}},Q=e("p",null," ",-1),Z={__name:"CartView",setup(U){const i=w(),x=V(),k=B(),o=q([]),p=async(a,l)=>{try{const{data:t}=await h.post("/users/cart",{product:a,quantity:l}),n=o.value.findIndex(C=>C.product._id===a);o.value[n].quantity+=l,o.value[n].quantity<=0&&o.value.splice(n,1),x.cart=t.result}catch(t){i({text:t.response.data.message,showCloseButton:!1,snackbarProps:{timeout:2e3,color:"red",location:"bottom"}})}},f=b(()=>o.value.reduce((a,l)=>a+l.quantity*l.product.price,0)),g=b(()=>o.value.length>0&&!o.value.some(a=>!a.product.sell)),v=async(a,l)=>{try{await h.post("/orders"),x.cart=0,k.push("/orders")}catch(t){console.log(t),i({text:t.response.data.message,showCloseButton:!1,snackbarProps:{timeout:2e3,color:"red",location:"bottom"}})}};return(async()=>{try{const{data:a}=await h.get("/users/cart");o.value.push(...a.result)}catch(a){i({text:a.response.data.message,showCloseButton:!1,snackbarProps:{timeout:2e3,color:"red",location:"bottom"}})}})(),(a,l)=>(u(),N(R,null,{default:r(()=>[s(A,null,{default:r(()=>[s(m,{cols:"12"},{default:r(()=>[D]),_:1}),s(m,{cols:"12",style:{"box-shadow":"2px 2px 2px 4px rgba(255, 255, 255, 0.7)",background:"white"}},{default:r(()=>[s(P,{class:"table"},{default:r(()=>[E,e("tbody",null,[(u(!0),_($,null,S(o.value,t=>(u(),_("tr",{key:t._id,class:z({"bg-red-lighten-5":!t.product.sell})},[e("td",null,[s(I,{src:t.product.image,cover:"",width:"200","aspect-ratio":"1"},null,8,["src"])]),e("td",null,c(t.product.name),1),e("td",null,c(t.product.price),1),e("td",null,[s(d,{color:"primary",variant:"text",icon:"mdi-minus",onClick:n=>p(t.product._id,-1)},null,8,["onClick"]),y(" "+c(t.quantity)+" ",1),s(d,{color:"primary",variant:"text",icon:"mdi-plus",onClick:n=>p(t.product._id,1)},null,8,["onClick"])]),e("td",null,c(t.quantity*t.product.price),1),e("td",null,[s(d,{color:"red",variant:"text",icon:"mdi-delete",onClick:n=>p(t.product._id,t.quantity*-1)},null,8,["onClick"])])],2))),128)),o.value.length===0?(u(),_("tr",F,L)):T("",!0)])]),_:1})]),_:1}),s(m,{cols:"12",class:"text-center"},{default:r(()=>[e("p",O,"總金額: "+c(f.value)+"元",1),Q,s(d,{color:"orange",onClick:v,disabled:!g.value},{default:r(()=>[y("結帳")]),_:1},8,["disabled"])]),_:1})]),_:1})]),_:1}))}};export{Z as default};
